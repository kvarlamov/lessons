Моё решение имеет ряд общих выводимых полей в сравнении с эталонным.
Однако ему не хватает части выводимых полей, а также не всегда верно рассчитаны формулы.
Также, несмотря на то, что здесь я использовал несколько cte, можно было ещё больше разбить
решение на логические блоки (добавить ещё cte).